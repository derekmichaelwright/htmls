---
title: "Economics of Canada"
subtitle: "GDP data among Canadian provinces from 2007-2018"
date: "2020-10-01"
author: "Derek Michael Wright <wrightmderek@gmail.com> [www.dblogr.com/](https://dblogr.com/) [-Image Gallery-](https://dblogr.com/graphs_dblogr/economics_of_canada/)"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T, message = F, warning = F, out.width = "100%")
```

---

# Introduction

The purpose of this vignette is to explore some economic GDP data available from STATCAN. 

STATCAN data Tables: 36-10-0400-01, 36-10-0402-01, 17-10-0009-01

---

# Prepare Data

```{r}
# devtools::install_github("derekmichaelwright/agData")
library(agData) # Loads: tidyverse, ggpubr, ggbeeswarm, ggrepel
library(readxl) # read_xlsx()
```

```{r}
# Factor levels
provinces <- c("British Columbia",  "Alberta", "Saskatchewan", "Manitoba", "Ontario", "Quebec", 
               "New Brunswick", "Prince Edward Island", "Nova Scotia", "Newfoundland and Labrador",  
               "Yukon", "Northwest Territories", "Nunavut")
provShort <- c("BC","AB","SK","MB","ON","QC","NB","PE","NS","NL","YT","NT","NU")
# GDP by province
d1 <- read_xlsx("STATCAN_Economics.xlsx", "3610040201") %>%
  mutate(`Current dollars` = `Current dollars` * 1000000,
         Area = factor(Area, levels = provinces),
         Area_Short = plyr::mapvalues(Area, provinces, provShort)) %>%
  select(Area, Area_Short, everything())
# GDP percent by industry
d2 <- read_xlsx("STATCAN_Economics.xlsx", "3610040001") %>%
  mutate(Area = factor(Area, levels = provinces),
         Area_Short = plyr::mapvalues(Area, provinces, provShort)) %>%
  select(Area, Area_Short, everything()) #%>%
  #gather(Industry, Percent, 4:ncol(.))
# Population by province
d3 <- read_xlsx("STATCAN_Population.xlsx", "1710000901") %>% 
  gather(Year, Number, 2:ncol(.)) %>%
  separate(Year, c("Quarter","Year")) %>% 
  group_by(Area, Year) %>% 
  summarise(Number = round(mean(Number, na.rm = F))) %>% 
  ungroup() %>%
  mutate(Area = factor(Area, levels = provinces),
         Year = as.numeric(Year))
```

---

# GDP by Province

```{r}
# Prep data
xx <- d1 %>% filter(Year == 2016) %>%
  arrange(desc(`Current dollars`)) %>% 
  mutate(Area = factor(Area, levels = unique(Area)),
         Value = `Current dollars` / 1000000000)
# Plot
mp <- ggplot(xx, aes(x = Area, y = Value, fill = Area)) + 
  geom_bar(stat = "identity", color = "black", alpha = 0.7) +
  theme_agData(legend.position = "none",
        axis.text.x = element_text(angle = 90, vjust = 0.4, hjust = 1)) +
  labs(title = "GDP by Province (2016)", y = "Current Dollars (Billion)",
       caption = "\xa9 www.dblogr.com/  |  Data: STATCAN")
ggsave("economics_of_canada_01.png", mp, width = 6, height = 4)
```

```{r echo = F}
ggsave("../../../myblog/content/graphs_dblogr/economics_of_canada/gallery/gallery/economics_of_canada_01.png", mp, width = 6, height = 4)
ggsave("../../../myblog/content/posts_dblogr/economics_of_canada/featured.png", mp, width = 6, height = 4)
```

![](economics_of_canada_01.png)

---

```{r}
# Prep data
xx <- d1 %>% mutate(Value = `Current dollars` / 1000000000)
x2 <- xx %>% filter(Year == 2016, Value > 200)
# Plot
mp <- ggplot(xx, aes(x = Year, y = Value, color = Area)) + 
  geom_line() +
  coord_cartesian(xlim = c(1997.75, 2015.25)) +
  scale_y_continuous(sec.axis = sec_axis(~ ., breaks = x2$Value, labels = x2$Area)) +
  theme_agData(legend.position = "none") +
  labs(title = "GDP by Province", y = "Current Dollars (Billion)",
       caption = "\xa9 www.dblogr.com/  |  Data: STATCAN")
ggsave("economics_of_canada_02.png", mp, width = 6, height = 4)
```

```{r echo = F}
ggsave("../../../myblog/content/graphs_dblogr/economics_of_canada/gallery/gallery/economics_of_canada_02.png", mp, width = 6, height = 4)
```

![](economics_of_canada_02.png)

---

```{r}
# Plot
mp <- mp + facet_wrap(Area ~ ., scale = "free_y", ncol = 5) + 
  scale_y_continuous()
ggsave("economics_of_canada_03.png", mp, width = 10, height = 4)
```

```{r echo = F}
ggsave("../../../myblog/content/graphs_dblogr/economics_of_canada/gallery/gallery/economics_of_canada_03.png", mp, width = 10, height = 4)
```

![](economics_of_canada_03.png)

---

```{r}
# Prep data
wc <- c("British Columbia", "Alberta", "Saskatchewan", "Manitoba",
        "Yukon", "Northwest Territories", "Nunavut")
xx <- xx %>% filter(!is.na(`Current dollars`)) %>%
  mutate(Region = ifelse(Area %in% wc, "Western Canada", "Eastern Canada")) %>%
  group_by(Region, Year) %>% 
  summarise(Value = sum(Value))
# Plot
mp <- ggplot(xx, aes(x = Year, y = Value, color = Region)) + 
  geom_line(size = 1.5, alpha = 0.7) + 
  geom_point(size = 2) +
  coord_cartesian(xlim = c(1997.75, 2015.25)) +
  scale_color_manual(values = c("darkblue", "darkred")) +
  theme_agData(legend.position = "bottom") +
  labs(y = "Current Dollars (Billion)",
       caption = "\xa9 www.dblogr.com/  |  Data: STATCAN")
ggsave("economics_of_canada_04.png", mp, width = 6, height = 4)
```

```{r echo = F}
ggsave("../../../myblog/content/graphs_dblogr/economics_of_canada/gallery/gallery/economics_of_canada_04.png", mp, width = 6, height = 4)
```

![](economics_of_canada_04.png)

---

# GDP Per Person

```{r}
# Prep data
xx <- d1 %>% left_join(d3, by = c("Area", "Year")) %>%
  mutate(GDP_PP = `Current dollars` / Number / 1000000) %>%
  filter(!is.na(GDP_PP))
x2 <- xx %>% filter(Year == 2016) %>%
  arrange(desc(GDP_PP)) %>% 
  mutate(Area = factor(Area, levels = unique(Area)))
# Plot
mp <- ggplot(x2, aes(x = Area, y = GDP_PP, fill = Area)) + 
  geom_bar(stat = "identity", color = "black", alpha = 0.7) +
  theme_agData(legend.position = "none",
        axis.text.x = element_text(angle = 90, vjust = 0.4, hjust = 1)) +
  labs(title = "GDP Per Person by Province (2016)", y = "Current Dollars (Million)",
       caption = "\xa9 www.dblogr.com/  |  Data: STATCAN")
ggsave("economics_of_canada_05.png", mp, width = 6, height = 4)
```

```{r echo = F}
ggsave("../../../myblog/content/graphs_dblogr/economics_of_canada/gallery/gallery/economics_of_canada_05.png", mp, width = 6, height = 4)
```

![](economics_of_canada_05.png)

---

```{r}
mp <- ggplot(xx, aes(x = Year, y = GDP_PP, color = Area)) + 
  geom_line() +
  coord_cartesian(xlim = c(1999.5, 2015.5)) +
  scale_y_continuous(sec.axis = sec_axis(~ ., breaks = x2$GDP_PP, labels = x2$Area)) +
  theme_agData(legend.position = "none") +
  labs(title = "GDP Per Person", y = "Current Dollars (Million)",
       caption = "\xa9 www.dblogr.com/  |  Data: STATCAN")
ggsave("economics_of_canada_06.png", mp, width = 6, height = 4)
```

```{r echo = F}
ggsave("../../../myblog/content/graphs_dblogr/economics_of_canada/gallery/gallery/economics_of_canada_06.png", mp, width = 6, height = 4)
```

![](economics_of_canada_06.png)

---

```{r}
mp <- mp + facet_wrap(Area~., ncol = 5) + 
  scale_y_continuous()
ggsave("economics_of_canada_07.png", mp, width = 10, height = 4)
```

```{r echo = F}
ggsave("../../../myblog/content/graphs_dblogr/economics_of_canada/gallery/gallery/economics_of_canada_07.png", mp, width = 10, height = 4)
```

![](economics_of_canada_07.png)

---

```{r}
# Prep data
wc <- c("British Columbia", "Alberta", "Saskatchewan", "Manitoba",
        "Yukon", "Northwest Territories", "Nunavut")
xx <- xx %>% filter(!is.na(`Current dollars`)) %>%
  mutate(Region = ifelse(Area %in% wc, "Western Canada", "Eastern Canada")) %>%
  group_by(Region, Year) %>% 
  summarise(GDP_PP = mean(GDP_PP))
# Plot
mp <- ggplot(xx, aes(x = Year, y = GDP_PP, color = Region)) + 
  geom_line(size = 1.5, alpha = 0.7) + 
  geom_point(size = 2) +
  scale_color_manual(values = c("darkblue", "darkred")) +
  theme_agData(legend.position = "bottom") +
  labs(title = "GDP Per Person", y = "Current Dollars (Million)",
       caption = "\xa9 www.dblogr.com/  |  Data: STATCAN")
ggsave("economics_of_canada_08.png", mp, width = 6, height = 4)
```

```{r echo = F}
ggsave("../../../myblog/content/graphs_dblogr/economics_of_canada/gallery/gallery/economics_of_canada_08.png", mp, width = 6, height = 4)
```

![](economics_of_canada_08.png)

---

# Compare Privinces

```{r}
ggGDP_PP <- function(year, areas, colors) {
  # Prep data
  xx <- d2 %>% select(1:3, 9:ncol(.)) %>% 
    filter(Year == year, Area %in% areas) %>%
    gather(Industry, Value, 4:ncol(.)) %>%
    left_join(d3, by = c("Area", "Year")) %>%
    mutate(GDP_PP = Value / Number) %>%
    filter(!is.na(GDP_PP))
  levs <- xx %>% filter(Year == year, Area == areas[1]) %>% 
    arrange(Value) %>% pull(Industry)
  xx <- xx %>% 
    mutate(Industry = factor(Industry, levels = levs),
           Area = factor(Area, levels = areas))
  # Plot
  ggplot(xx, aes(x = Area, y = GDP_PP, fill = Area)) +
    geom_bar(stat = "identity", alpha = 0.7, color = "black") +
    scale_fill_manual(values = colors) +
    theme_agData(legend.position = "bottom", linesize = 0.1,
                 axis.text.x = element_blank(),
                 axis.ticks.x = element_blank()) +
    facet_grid(.~Industry, labeller = label_wrap_gen(width = 15)) +
    labs(title ="GDP Per Person 2016", y = "Million $ / Person", x = NULL,
         caption = "\xa9 www.dblogr.com/  |  Data: STATCAN")
}
```

---

```{r}
mp <- ggGDP_PP(2016, c("Alberta", "Quebec"), c("darkblue", "lightblue"))
ggsave("economics_of_canada_09.png", mp, width = 25, height = 8)
```

---

```{r echo = F}
ggsave("../../../myblog/content/graphs_dblogr/economics_of_canada/gallery/gallery/economics_of_canada_09.png", mp, width = 25, height = 8)
```

![](economics_of_canada_09.png)

---

```{r}
mp <- ggGDP_PP(2016, c("Alberta", "Ontario"), c("darkblue", "darkred"))
ggsave("economics_of_canada_10.png", mp, width = 25, height = 8)
```

---

```{r echo = F}
ggsave("../../../myblog/content/graphs_dblogr/economics_of_canada/gallery/gallery/economics_of_canada_10.png", mp, width = 25, height = 8)
```

![](economics_of_canada_10.png)

---

```{r}
mp <- ggGDP_PP(2016, c("Alberta", "British Columbia"), c("darkred", "darkgreen"))
ggsave("economics_of_canada_11.png", mp, width = 25, height = 8)
```

---

```{r echo = F}
ggsave("../../../myblog/content/graphs_dblogr/economics_of_canada/gallery/gallery/economics_of_canada_11.png", mp, width = 25, height = 8)
```

![](economics_of_canada_11.png)

---

```{r}
mp <- ggGDP_PP(2016, c("Saskatchewan", "Manitoba"), c("darkorange3", "darkmagenta"))
ggsave("economics_of_canada_12.png", mp, width = 25, height = 8)
```

```{r echo = F}
ggsave("../../../myblog/content/graphs_dblogr/economics_of_canada/gallery/gallery/economics_of_canada_12.png", mp, width = 25, height = 8)
```

![](economics_of_canada_12.png)

---

&copy; Derek Michael Wright 2020 [www.dblogr.com/](https://dblogr.netlify.com/)
